# Finance App API ![status](https://img.shields.io/badge/status-beta-yellow)

> **Status:** Em desenvolvimento (v1.0.0 â€“ _beta_)

## SumÃ¡rio

1. [VisÃ£o Geral](#visÃ£o-geral)
2. [Key Features](#key-features)
3. [Arquitetura](#arquitetura)
4. [Tecnologias & Justificativa](#tecnologias--justificativa)
5. [Como Rodar](#como-rodar)
6. [Configuration](#configuration)
7. [Estrutura de Pastas](#estrutura-de-pastas)
8. [PadrÃµes de CÃ³digo & Qualidade](#padrÃµes-de-cÃ³digo--qualidade)
9. [DomÃ­nio & Banco de Dados](#domÃ­nio--banco-de-dados)
10. [API](#api)
11. [SeguranÃ§a](#seguranÃ§a)
12. [Observabilidade](#observabilidade)
13. [Testes](#testes)
14. [CI/CD](#cicd)
15. [Roadmap](#roadmap)
16. [LicenÃ§a](#licenÃ§a)
17. [Links Ãšteis](#links-Ãºteis)

---

## VisÃ£o Geral

API REST para gerenciamento financeiro pessoal, permitindo que usuÃ¡rios registrem receitas, despesas e investimentos, consultem saldo e acompanhem transaÃ§Ãµes.

- **Escopo:** CRUD de usuÃ¡rios e transaÃ§Ãµes financeiras.
- **PÃºblico-alvo:** Desenvolvedores de aplicativos web/mobile que necessitam de um backend financeiro simples.
- **Screenshot / GIF:** _TBD_

## Key Features

- API REST modular (Controllers â†’ Services â†’ Repositories)
- ValidaÃ§Ã£o com Zod + DTOs tipados
- TypeScript estrito (noImplicitAny, strictNullChecks)
- PostgreSQL 15 + Prisma 6 (migrations, seed)
- Scripts de DX: lint, test, typecheck, db:migrate
- Docker Compose para ambiente local
- PadrÃ£o uniforme de respostas HTTP (`ok`, `created`, `badRequest` etc.)
- Roadmap: JWT, Pino logger, Observabilidade (OTel)

---

## Arquitetura

Camadas principais e responsabilidades:

| Camada             | Responsabilidade                                                   | Principais Pastas  |
| ------------------ | ------------------------------------------------------------------ | ------------------ |
| Controller         | Receber requisiÃ§Ãµes HTTP, validar entrada, orquestrar casos de uso | `src/controllers`  |
| Service / Use-Case | Regras de negÃ³cio independentes de infra                           | `src/services`     |
| Repository         | PersistÃªncia (PostgreSQL via Prisma)                               | `src/repositories` |
| Infra              | ConexÃ£o com DB, utilitÃ¡rios externos                               | `src/infra`        |

### Diagrama de Blocos (alto nÃ­vel)

```mermaid
flowchart TD
    Client -->|HTTP| API[Express 5]
    API --> Controller
    Controller --> Service
    Service --> Repository
    Repository -->|Prisma| PostgreSQL[(DB)]
```

### DecisÃµes TÃ©cnicas & Trade-offs

| #   | DecisÃ£o                      | Alternativas       | Trade-offs                                      |
| --- | ---------------------------- | ------------------ | ----------------------------------------------- |
| 1   | TypeScript em todo o backend | JavaScript puro    | + Tipagem estÃ¡tica, - curva de entrada          |
| 2   | Prisma ORM                   | TypeORM, Sequelize | + Migrations, DX, - abstraÃ§Ã£o extra             |
| 3   | Express 5                    | Fastify, NestJS    | + Simplicidade, - Sem REST helpers nativos      |
| 4   | UUID v4 como PK              | Auto-incremento    | + DistribuÃ­do, - String maior                   |
| 5   | Bcrypt para hash de senha    | Argon2             | + Popular, suporte nativo, - Argon2 mais seguro |

### Modos de ExecuÃ§Ã£o

- **Local (dev):** `npm run start:dev` + Docker Compose opcional.
- **Test:** `.env.test` + Docker Compose (service `postgres-test`).
- **ProduÃ§Ã£o:** Build (`npm run build`) + variÃ¡vel `NODE_ENV=production`.

---

## Tecnologias & Justificativa

- **Node.js 20 + Express 5:** Ecossistema maduro, ampla comunidade.
- **TypeScript 5:** Tipagem estÃ¡tica melhora manutenÃ§Ã£o.
- **PostgreSQL 15:** Relacional robusto, suporte a transaÃ§Ãµes.
- **Prisma 6:** ORM moderna com migrations automÃ¡ticas.
- **Docker Compose:** Facilita provisionamento local de banco.
- **Jest:** Testes unitÃ¡rios/integraÃ§Ã£o rÃ¡pidos.
- **ESLint + Prettier + Husky:** PadronizaÃ§Ã£o de cÃ³digo e CI local.

---

## Como Rodar

### PrÃ©-requisitos

- Node.js >= 20
- PNPM / NPM
- Docker & Docker Compose

### Setup Local

```bash
# clone
$ git clone https://github.com/SEU_USUARIO/finance-app-api.git && cd finance-app-api

# instale dependÃªncias
$ npm install

# suba o banco
$ docker compose up -d postgres

# configure variÃ¡veis
$ cp .env.example .env  # edite DATABASE_URL, PORT etc.

# run migrations & gerar client Prisma
$ npx prisma migrate deploy

# iniciar em desenvolvimento (hot-reload)
$ npm run start:dev
```

### Scripts Ãšteis

| Comando                 | DescriÃ§Ã£o                             |
| ----------------------- | ------------------------------------- |
| `npm run start:dev`     | Hot-reload via `tsx`                  |
| `npm run build`         | Compila TS para JS (`dist/`)          |
| `npm test`              | Executa testes com dotenv `.env.test` |
| `npm run test:coverage` | Cobertura Jest                        |

---

## Configuration

### VariÃ¡veis de Ambiente

| VariÃ¡vel     | DescriÃ§Ã£o                    | Exemplo                                               |
| ------------ | ---------------------------- | ----------------------------------------------------- |
| DATABASE_URL | URL de conexÃ£o ao Postgres   | postgresql://root:password@localhost:5432/finance-app |
| PORT         | Porta HTTP da API            | 3001                                                  |
| NODE_ENV     | Ambiente de execuÃ§Ã£o         | development                                           |
| JWT_SECRET   | Segredo criptogrÃ¡fico do JWT | TBD                                                   |

> Copie `.env.example` para `.env` e ajuste conforme seu ambiente.

---

## Estrutura de Pastas

```text
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ adapters        # AbstraÃ§Ãµes de infraestrutura (Hash, UUID)
â”‚   â”œâ”€â”€ controllers     # Camada HTTP / Express
â”‚   â”‚   â””â”€â”€ _helpers    # Helpers de resposta, validaÃ§Ã£o
â”‚   â”œâ”€â”€ services        # Regras de negÃ³cio (use-cases)
â”‚   â”œâ”€â”€ repositories    # ImplementaÃ§Ãµes Prisma/Postgres
â”‚   â”œâ”€â”€ schemas         # Schemas Zod (validaÃ§Ã£o)
â”‚   â”œâ”€â”€ infra           # ConexÃµes e utilitÃ¡rios externos
â”‚   â””â”€â”€ shared          # Tipos e helpers genÃ©ricos
â”œâ”€â”€ prisma              # Schema & migrations
â”œâ”€â”€ tests               # (Em `src/**.test.ts`) Fixtures e mocks
â””â”€â”€ docker-compose.yml  # ServiÃ§os locais
```

---

## PadrÃµes de CÃ³digo & Qualidade

- **Style Guide:** ESLint (`@eslint/js`) + Prettier.
- **Import Sorting:** `eslint-plugin-simple-import-sort`.
- **Commits SemÃ¢nticos:** Validado por `git-commit-msg-linter` via Husky _pre-commit_.
- **Coverage Gate:** Jest > 80% _(TBD)_.

---

## DomÃ­nio & Banco de Dados

Diagrama ER (simplificado):

```mermaid
erDiagram
    USER {
        STRING id PK
        STRING first_name
        STRING last_name
        STRING email "unique"
        STRING password
    }
    TRANSACTION {
        STRING id PK
        STRING user_id FK
        STRING name
        DECIMAL amount
        DATE date
        ENUM type
    }
    USER ||--o{ TRANSACTION : "1:N"
```

---

## API

### Rotas Principais

```mermaid
flowchart LR
    subgraph Users
        U1[POST /api/users]
        U2[GET /api/users/:userId]
        U3[PATCH /api/users/:userId]
        U4[DELETE /api/users/:userId]
        U5[GET /api/users/:userId/balance]
    end
    subgraph Transactions
        T1[POST /api/transactions]
        T2[GET /api/transactions?userId=]
        T3[PATCH /api/transactions/:transactionId]
        T4[DELETE /api/transactions/:transactionId]
    end
    Client --> U1 & U2 & U3 & U4 & U5 & T1 & T2 & T3 & T4
```

#### SequÃªncia (ex.: criaÃ§Ã£o de transaÃ§Ã£o)

```mermaid
sequenceDiagram
    participant C as Client
    participant API as Express
    participant DB as PostgreSQL

    C->>API: POST /api/transactions { JSON body }
    API->>DB: INSERT transaction
    DB-->>API: 201 Created
    API-->>C: Body { status: "success", data: {...} }
```

### Exemplos de RequisiÃ§Ã£o

Criar usuÃ¡rio:

```bash
curl -X POST http://localhost:3001/api/users \
  -H "Content-Type: application/json" \
  -d '{
    "firstName": "Ada",
    "lastName": "Lovelace",
    "email": "ada@example.com",
    "password": "s3cret"
}'
```

Resposta de sucesso _(201)_:

```json
{
    "status": "success",
    "message": "Created successfully",
    "data": {
        "id": "uuid",
        "firstName": "Ada",
        "email": "ada@example.com"
    }
}
```

Formato de erro _(400)_:

```json
{
    "status": "error",
    "message": "Validation error",
    "data": {
        "field": "email",
        "error": "already in use"
    }
}
```

> Para mais exemplos consulte `resquests.http`.

---

## SeguranÃ§a

- **Hash de senha:** `bcrypt` com salt 10.
- **ValidaÃ§Ã£o:** Schemas Zod para entrada.
- **ProteÃ§Ã£o bÃ¡sica:** Express Helmet _(TBD)_.
- **AutenticaÃ§Ã£o:** Token JWT _(Roadmap)_.

---

## Observabilidade

- **Logs estruturados:** `console` _(substituir por Pino â€“ Roadmap)_.
- **Tracing / Metrics:** TBD (OpenTelemetry + Prometheus).
- **Health-check:** Docker Compose healthcheck no DB de testes.

---

## Testes

- **Framework:** Jest + `@faker-js`.
- **Tipos de teste:**
    - UnitÃ¡rios (use-cases)
    - IntegraÃ§Ã£o (controllers + DB docker-test)
- **Cobertura atual:** `npm run test:coverage` â€“ _TBD%_.

---

## CI/CD

| Etapa  | DescriÃ§Ã£o                       | Status                      |
| ------ | ------------------------------- | --------------------------- |
| Lint   | ESLint + Prettier               | âœ… Husky _pre-commit_       |
| Testes | Jest em ambiente Docker         | ğŸŸ¡ Planned (GitHub Actions) |
| Build  | `tsc` + Docker image            | ğŸŸ¡ Planned                  |
| Deploy | TBD (Railway / Render / Fly.io) | ğŸ”²                          |

---

## Roadmap

- [ ] AutenticaÃ§Ã£o JWT e refresh token
- [ ] PaginaÃ§Ã£o e filtros em `/api/transactions`
- [ ] Logs estruturados com Pino
- [ ] Observabilidade (OpenTelemetry)
- [ ] Dockerfile multistage & CI para build automÃ¡tico

---

## LicenÃ§a

ISC Â© KauÃ£ Ortolani Lusvarghi â€“ 2025

---

## Links Ãšteis

- [Node.js](https://nodejs.org/)
- [Express](https://expressjs.com/)
- [Prisma](https://www.prisma.io/)
- [PostgreSQL](https://www.postgresql.org/)
- [Mermaid](https://mermaid.js.org/)
